

For Xcode Archive, you need:                       
                                                     
  # 1. Build nora-core                               
  cd packages/nora-core && npm run build             
                                                     
  # 2. Generate/update native iOS files              
  cd ../../nora-mobile && npx expo prebuild --platform ios                                                
                                                     
  # 3. Install CocoaPods                             
  cd ../ios && pod install                              
                                                     
  # 4. Open in Xcode                                 
  open Nora.xcworkspace                              
                                                     
  Then in Xcode: Product → Archive                   
                                                     
  Don't forget: Deploy your Docker server first for  
  the new API changes to work.       




1. native code changes
npx expo run:ios (Local build)

2.   npm run build (  cd packages/nora-core && npm run build  )
  - Compiles TypeScript → JavaScript locally
  - Takes ~2 seconds
  - Just transforms your shared library code
  - Run this when you change code in packages/nora-core

3. backend changes
  ./docker_deploy.sh 
  
  ### Docker Rebuild and Push to ECR
  cd /Users/mia/nora
  # Build Docker image
  #docker build -t nora-backend .
  docker build --platform linux/amd64 -t nora-backend:latest .     
  # Login to ECR 
  aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 059364397483.dkr.ecr.us-east-1.amazonaws.com
  # Tag image
  docker tag nora-backend:latest 059364397483.dkr.ecr.us-east-1.amazonaws.com/nora:latest
  # Push to ECR
  docker push 059364397483.dkr.ecr.us-east-1.amazonaws.com/nora-backend:latest
  # Trigger an App Runner deployment (if not automatically started)
  aws apprunner start-deployment --service-arn arn:aws:apprunner:us-east-1:059364397483:service/nora-api/0f1877f0a2d8454da6a4ebde1979fec6 --region us-east-1
  #Verify ECR Deployment
  aws ecr describe-images --repository-name nora-backend --region us-east-1 --query 'sort_by(imageDetails,& imagePushedAt)[-1]'


4. TestFlight/App Store distribution
cd /nora-mobile
4.1 development 
eas build --platform ios --profile development 
4.2 production
eas build --platform ios --profile production
eas submit --platform ios



***Difference between eas build and expo run:ios***

npx expo run:ios (Local build)
  - Builds directly on your Mac using Xcode
  - Fast iteration - only rebuilds changed native code
  - Runs on simulator or connected device
  - Requires Xcode and CocoaPods installed locally
  - Good for development/testing native changes

eas build --platform ios --profile development
  - Builds on Expo's cloud servers (EAS)
  - Creates a full .ipa or simulator build
  - Slower - uploads code, queues, builds from scratch
  - Doesn't require Xcode on your machine
  - Produces a downloadable/installable artifact
  - Required for TestFlight/App Store distribution


 Run this command to update the provisioning profile:

  eas device:create

  This will prompt you to register new devices. Or if you already added the device in Apple Developer Portal:

  eas credentials


about docker
  What we fixed:                                          
  1. deploy.sh - Added --platform linux/amd64 for AWS     
  compatibility                                           
  2. Dockerfile - Prisma client now generated at build    
  time, not runtime                                       
                                                          
  Things to note:                                         
  - Build is slower (~30-60s) due to amd64 emulation on M4
  - Local testing requires --platform linux/amd64 flag (or
   won't run natively)                                    
  - If you add new Prisma models, just rebuild - the      
  client regenerates during build                         
                                                          
  If deployment fails again:                              
  1. Check App Runner logs: aws logs tail "/aws/apprunner/
  nora-api/0f1877f0a2d8454da6a4ebde1979fec6/application"  
  --since 10m                                             
  2. Verify image pushed: aws ecr describe-images         
  --repository-name nora --image-ids imageTag=latest 